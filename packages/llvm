package_name=llvm
package_version=3.8.0
tarball_suffix=xz
package_fullname=llvm-3.8.0.src
url=http://llvm.org/releases/3.8.0/llvm-3.8.0.src.tar.xz
build_dependencies=
iscustombuild=1
haspostinstall=1

# for c++ to work, link /opt/native-compiler/x86_64-linux-musl/lib64/* to /lib,
# and create musl-g++ wrapper in /bin, exactly like musl-gcc (you can copy it)
# and create /opt/musl/lib/musl-g++.specs from x86_64-linux-musl-g++ -dumpspecs
# changing cc1plus and linker entries to -I /usr/local/include and -L /usr/lib

custombuild(){
        package_fullname=${package_fullname:-"$package_name-$package_version"}
        package_tarball_name=$package_fullname.tar.$tarball_suffix
        rm $package_tarball_name
        wget $url
        tar xvf $package_tarball_name
	cd $package_fullname
	for p in ../packages/llvm-*.patch; do
		patch -p1 < $p
	done
	cd ..
	mkdir llvm-build
	cd llvm-build
        ../$package_fullname/configure --prefix=/opt/$package_fullname/
        #cd ../$package_fullname/
        make
        make install
        ln -sv /opt/$package_fullname /opt/$package_name
        ln -sv /opt/$package_name/bin/* /bin/
        cd ..
}


postinstall(){
	rm -r llvm-build
	ln -sv /opt/llvm/lib/* /usr/lib
	ln -sv /opt/llvm/include/* /usr/local/include
}
