package_name=glib
package_version=2.48.1
tarball_suffix=xz
url=http://ftp.gnome.org/pub/gnome/sources/glib/2.48/$package_name-$package_version.tar.$tarball_suffix
build_dependencies="python libffi pcre" # python is needed for proper installation
iscustombuild=1

custombuild(){
	set -ex
	package_fullname=$package_name-$package_version
	wget -O archive $url
	tar xvf archive
	rm archive
	cd $package_name*

	pwd="`pwd`"
	for p in "$pwd"/../packages/$package_name-*.patch; do
		patch -p1 < $p
	done

	LDFLAGS="-Wl,-rpath=/opt/pcre/lib/ -Wl,-rpath=/opt/libffi/lib64 -Wl,-rpath=/opt/zlib/lib"  ./configure --prefix=/opt/$package_fullname/   # apparently a bug in configure
	make -j
	make install
	ln -sv /opt/$package_fullname /opt/$package_name
	ln -sv /opt/$package_name/bin/* /bin/ || true
	ln -svf /opt/$package_name/lib/pkgconfig/* /opt/pkgconf/lib/pkgconfig/   # some packages rely on pkgconf
	cd ..
	rm -r $package_name*
	set +ex
}