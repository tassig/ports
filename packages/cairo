package_name=cairo
package_version=1.14.6
url=https://www.cairographics.org/releases/$package_name-$package_version.tar.xz
build_dependencies="zlib expat libpng libffi"
iscustombuild=1

# custom build because zlib not found automatically by this build system
custombuild(){
	set -ex
	package_fullname=$package_name-$package_version
	wget -O archive $url
	tar xvf archive
	rm archive
	cd $package_name*
	
	patch -p1 < ../packages/cairo-build.patch   # patching the build system so zlib is found TODO: send the patch upstream
	autoreconf
	
	./configure --prefix=/opt/$package_fullname/ 
	make -j
	make check
	make install
	ln -sv /opt/$package_fullname /opt/$package_name
	ln -sv /opt/$package_name/bin/* /bin/ || true   # don't crash if the links are already there
	ln -sv /opt/$package_name/lib/pkgconfig/* /opt/pkgconf/lib/pkgconfig/   || true
	cd ..
	set +ex
}
