package_name=tcl-tk
package_version=8.6.5
tarball_suffix=gz
rel_url=tcl/tk8.6.5-src.tar.gz
iscustombuild=1
build_dependencies=tcl-core
no_check=1


custombuild(){
    rm -rf builddir
    mkdir -p builddir   # do everything in builddir for tidiness
    cd builddir
    if [ "$url" == "" ]; then
        # if no absolute $url defined, then assume, that we have relative url 
        # $rel_url
        url=$mirror_prefix/$rel_url
    fi
    wget -O archive $url
    tar xvf archive
    rm archive
    cd *   # cd into the package directory
    cd unix/
    
    # CPPFLAGS - because we split tcl-tk and tcl-core and build scripts will 
    # not notice it. I have tried to patch configure.in, but it took too
    # long time to determine why it is not working. Maybe it should be "todo"
    # --with-tcl - points to directory with tclConfig.sh
    CPPFLAGS="-I$installdirectory/tcl-core/include/" ./configure --prefix=$installdirectory/$package_fullname/ --with-x --x-includes=$installdirectory/xorg/include --x-libraries=$installdirectory/xorg/lib --with-tcl=$installdirectory/tcl-core/lib

    make -j
    if test -z $no_check   # run the make check, unless $no_check is set for 
                           # this package definition
    then make -j check || make -j test
    fi
    make install
    ln -sv $installdirectory/$package_fullname $installdirectory/$package_name
    ln -sv $installdirectory/$package_name/bin/* /bin/ || true   # don't crash 
                                            # if the links are already there
    if [ -d "$installdirectory/$package_name/lib/pkgconfig" ]; then
        ln -svf $installdirectory/$package_name/lib/pkgconfig/* \
        $installdirectory/pkgconf/lib/pkgconfig/   # install pkg-config files
    fi
    cd ../../..
    rm -r builddir
}



