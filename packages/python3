package_name=Python
package_version=3.5.1
tarball_suffix=xz
url=https://www.python.org/ftp/python/3.5.1/Python-3.5.1.tar.xz
build_dependencies=
iscustombuild=1


# hashlib and ssl fails to build, because of
# ld: /opt/libressl/lib/libcrypto.a(libcrypto_la-err.o): relocation R_X86_64_32 against `.rodata' can not be used when making a shared object; recompile with -fPIC
# TODO: fix

custombuild(){
        package_fullname=$package_name-$package_version
        wget $url
        tar xvf $package_fullname.tar.$tarball_suffix
        cd $package_fullname/
        ./configure --prefix=/opt/$package_fullname/
        
        echo 'Error: you need to do a manual operation during the Python build:'
	echo 'Edit Module/Setup file:'
	echo ' find SSL module part, and edit to look like this:'
	echo ' SSL=/opt/libressl
	echo ' _ssl _ssl.c \'
	echo '      -DUSE_SSL -I$(SSL)/include -I$(SSL)/include/openssl \'
	echo '      -L$(SSL)/lib -lssl -lcrypto'
        exit 1
        
        make
        make install
        ln -sv /opt/$package_fullname /opt/$package_name
        ln -sv /opt/$package_name/bin/* /bin/
	# make python3 the default python, some software expect "python" to exist
	ln -sv /bin/python3 /bin/python
        cd ..
}
